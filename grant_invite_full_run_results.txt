--- Starting Grant/Invite Access Test Plan (Attempt 3 with CSRF exempt) ---
\n--- I. Database Setup ---
=== Setup Script Output START ===
--- MAIL CONFIGURATION ---
MAIL_SERVER: smtp.example.com
MAIL_PORT: 587
MAIL_USE_TLS: True
MAIL_USERNAME: your-email@example.com
MAIL_PASSWORD loaded: Yes
--------------------------
--- Starting Setup for Grant/Invite Tests ---
User testadmin exists (ID: 1). Ensured role is admin and status active.
ADMIN_USER_ID:1
User grantexp exists (ID: 12). Ensured role is expert and status active.
USER_ID_GRANTEXP:12
User grantcon exists (ID: 13). Ensured role is contractor and status active.
USER_ID_GRANTCON:13
User grantadm exists (ID: 14). Ensured role is admin and status active.
USER_ID_GRANTADM:14
User testviewer_expert exists (ID: 15). Ensured role is expert and status active.
USER_ID_TESTVIEWER_EXPERT:15
Project ProjectX_GA_Test exists (ID: 5).
Project ProjectY_GA_Test exists (ID: 6).
PROJECT_ID_X:5
PROJECT_ID_Y:6
Cleaned up pre-existing project access for grant test users on ProjectX and ProjectY.
--- Setup for Grant/Invite Tests Complete ---
=== Setup Script Output END ===
Extracted IDs: ADMIN_USER_ID=1, GRANTEXP_USER_ID=12, GRANTCON_USER_ID=13, GRANTADM_USER_ID=14, VIEWER_EXPERT_USER_ID=15, PROJECT_X_ID=5, PROJECT_Y_ID=6
\n--- II. Test Execution (Logged as testadmin) ---
Starting Flask server...
Flask PID: 8625
Logging in as testadmin...
\n  A. 'Invite New User' Section (as testadmin):
    1. UI Check:

--- Analysis for User: testadmin viewing /manage_access ---
  II.A.1 'Invite New User' Section UI (as Admin):
      Invite role select dropdown is present: PASS
      Admin option NOT in invite role dropdown: PASS
      Expert option IS in invite role dropdown: PASS
      Contractor option IS in invite role dropdown: PASS
      Supervisor option IS in invite role dropdown: PASS
  II.B.1 'Grant Access to Existing User' Section UI (as Admin):
      Role selection div NOT present in Grant Access form: PASS
    2. Functionality Test (Invite newly_invited_expert@example.com):
Pre-cleaned any existing records for newly_invited_expert@example.com
{"email_info":{"error":"[Errno -2] Name or service not known","sent":false},"invite_link":"http://127.0.0.1:5000/accept_invite/eyJ1c2VyX2lkIjoxNn0.aEyPBw.lQQBkI2505NosNb0T1E_0s_W3Kc","message":"Invitation link generated for newly_invited_expert@example.com for project(s): ProjectX_GA_Test. Email sending failed.","status":"success"}

DB Check for invited user:
temp_28aa31e279c4d214|newly_invited_expert@example.com|expert|pending_activation
21|16|5|expert
\n  B. 'Grant Access to Existing User' Section (as testadmin):
    B2.1 Grant grantexp (Expert) to ProjectX_GA_Test:
Grant B1 Headers:
HTTP/1.1 302 FOUND
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 215
Location: /manage_access
Vary: Cookie
Set-Cookie: session=.eJwlj0tqAzEQRK8iepWACZJan9Hcw6tgTKs_OCFgM5pZGd89IlkVVQ-Kqidc7YfGTQesn09w-xQYB7OOASc4D90c_Tl3PIR2FWf3zQX32O7fyvvbeP-Ay-tymj2bjhus-3bodF8CK2ApqRDlxXqoPnXPLVhBiZmiEtqkAXEpKeFMljSZx5hiU68xEAv6iI39UjP7rsipeqmZUJnF99CscaeEKD1mMUTiqmYSjErNVeeD6zEv_K8J8PoFhYlHJw.aEyPBw.YC3Fv79Fn-kcVPds_L70Q5FxmUk; HttpOnly; Path=/
Connection: close

HTTP/1.1 200 OK
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 48229
Vary: Cookie
Set-Cookie: session=.eJwljkFqQzEMRO_idRayJFt2LvORZYmWQAv_J6uQu1fQ5byBmfcuR5x-fZX783z5rRzfu9wL9c5dtY1YVYAX2KzRaWNTdKXIthKNzkxJBmcHhIzTwbGqbQKkaTCkGSwnY4EtTcnNNqw6Y9pSJtoL2w4iNfGIXUO7NPGSIq_Lz3-bmtGuM47n78N_EhggEkgwcuccHyRu0K3Tsp0nqik8UcvnD2wPPxE.aEyPBw.RV0jaq1sCGHzXk5HDPHxMcKt2UM; HttpOnly; Path=/
Connection: close


22|12|5|expert
    B2.2 Grant grantcon (Contractor) to ProjectY_GA_Test:
Grant B2 Headers:
HTTP/1.1 302 FOUND
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 215
Location: /manage_access
Vary: Cookie
Set-Cookie: session=.eJwlj0tqAzEQRK8iepWACZJan9Hcw6tgTKs_OCFgM5pZGd89IlkVVQ-Kqidc7YfGTQesn09w-xQYB7OOASc4D90c_Tl3PIR2FWf3zQX32O7fyvvbeP-Ay-tymj2bjhus-3bodF8CK2ApqRDlxXqoPnXPLVhBiZmiEtqkAXEpKeFMljSZx5hiU68xEAv6iI39UjP7rsipeqmZUJnF99CscaeEKD1mMUTiqmYSjErNVeeD6zEv_K8J8PoFhYlHJw.aEyPBw.YC3Fv79Fn-kcVPds_L70Q5FxmUk; HttpOnly; Path=/
Connection: close

HTTP/1.1 200 OK
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 50137
Vary: Cookie
Set-Cookie: session=.eJwljjtuAzEMBe-i2oWoR_18mQVJkUhgIAF27crw3SMg5cw0805HnH59pfvzfPktHd8r3RNa4yZSRyj1zJptUjSsUqW4IHYlYDRmbDN4t4zCZXr2QmILuWBaHr1aVodxz6tXgZutrDRjmgoDS0tdAYh1j1gU0nrtnvbI6_Lz_4Y22nXG8fx9-M8WkxWEqGNwHc7FMLpGZKts1khIQwEd6fMHcdw_KQ.aEyPBw.Ea_JGrosr1uftdVk6z3PtmPJm1w; HttpOnly; Path=/
Connection: close


23|13|6|contractor
    B2.3 Grant grantadm (Admin) to ProjectX_GA_Test:
Grant B3 Headers:
HTTP/1.1 302 FOUND
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 215
Location: /manage_access
Vary: Cookie
Set-Cookie: session=.eJwlj0tqAzEQRK8iepWACZJan9Hcw6tgTKs_OCFgM5pZGd89IlkVVQ-Kqidc7YfGTQesn09w-xQYB7OOASc4D90c_Tl3PIR2FWf3zQX32O7fyvvbeP-Ay-tymj2bjhus-3bodF8CK2ApqRDlxXqoPnXPLVhBiZmiEtqkAXEpKeFMljSZx5hiU68xEAv6iI39UjP7rsipeqmZUJnF99CscaeEKD1mMUTiqmYSjErNVeeD6zEv_K8J8PoFhYlHJw.aEyPBw.YC3Fv79Fn-kcVPds_L70Q5FxmUk; HttpOnly; Path=/
Connection: close

HTTP/1.1 200 OK
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 51412
Vary: Cookie
Set-Cookie: session=.eJwljjtqQzEQAO-i2sVqV1pJvsxjvyQYEnjProzvHkHKmWnmXY484_oq9-f5ils5vr3cCzE3FukztQ5oCrZqMjl2wRDKXSvR5NZom9l2A8KGKyCwijkB0jKYoxtokLUBPrpQmDloXblMpRG5YvckEhuR6TWFRx9R9sjrivP_pm6068zj-fuIny3cF-nSmMoO5EszJxvUmNAHa0XkJjisfP4Ai-U_Ww.aEyPBw.gCVQgaJvyKF9ac6bIpfPmiGaARU; HttpOnly; Path=/
Connection: close


24|14|5|admin
    B2.4 Grant grantexp (Expert) to ProjectX_GA_Test AGAIN:
Grant B4 Headers:
HTTP/1.1 302 FOUND
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 215
Location: /manage_access
Vary: Cookie
Set-Cookie: session=.eJw1kFFqwzAQRK-y6KuFUCStbNk-RC9QQlitVrGLYxXJaQkhd6_a0q_ZmfczO3d1SivVWaqa3u4K9iZq2VJWB_WagWfazlLhQlFgz3CtUoCYpVZ4-jUXugGtRSjeYKZP-adfyz7DPstS4LzmQCuUvArkDaqswrtE-Cj5vV31-UUdH8dDa1Kkzmray1WaW6KaFPa964m6IQXjtQuaR5N6jLYjK4SpUYM49M5hSwbXmEbr7CharCGOqC2OrAffsQ6C7LyOviMU5qiDGdPIgRxiDLaLCZHYS0rRJOp956XNcPr586-NUY9vrHBfSg.aEyPBw.FzCQFHk8NtdsiXCl_5b41OsPj_4; HttpOnly; Path=/
Connection: close

HTTP/1.1 200 OK
Server: Werkzeug/3.1.3 Python/3.10.17
Date: Fri, 13 Jun 2025 20:50:15 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 51479
Vary: Cookie
Set-Cookie: session=.eJwljkuKAzEMRO_idRayZFl2LtPI-jBDYAa6k1XI3ccwq6LqUfDe5cgzrq9yf56vuJXj28u9UO-tq_LIVQXaAps1OzmyYijlppVo9NZoL6NtBoQNZ0BgVXMCpGkwhA1WkDUBF1YKM4dVZ05b2oh8IXsSqUlkek3twhJli7yuOP9t6q52nXk8fx_xs4feaQkT7ktDjxSYLMhDJiOEh0j6zlo-f3NHPw4.aEyPBw.a0MEUClIb-np9nfCyjtlmiQ2iw8; HttpOnly; Path=/
Connection: close


Flash message 'No changes made' check:
1
\n--- III. Test Non-Admin View (Logged as testviewer_expert) ---
Logging in as testviewer_expert...

--- Analysis for User: testviewer_expert viewing /manage_access ---
  III. Non-Admin View (testviewer_expert): Section Visibility
      'Grant Access' section HIDDEN: PASS
      'Invite New User' section HIDDEN: PASS
\n--- Stopping Flask Server ---
Flask server should be stopped.
